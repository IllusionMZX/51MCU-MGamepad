C51 COMPILER V9.60.7.0   USART                                                             12/05/2024 19:55:12 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE USART
OBJECT MODULE PLACED IN .\Objects\USART.obj
COMPILER INVOKED BY: E:\Program Files\Keil_v5\Keil_arm\C51\BIN\C51.EXE USART.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJE
                    -CTEXTEND PRINT(.\Listings\USART.lst) OBJECT(.\Objects\USART.obj)

line level    source

   1          #include "USART.h"
   2          
   3          char RxBuffer[RxBuffer_Len] = {0};
   4          bit USART_Busy;
   5          
   6          void String_Analysis()
   7          {
   8   1      
   9   1      }
  10          
  11          
  12          /*----------------------------
  13          Send a string to UART
  14          Input: s (address of string)
  15          Output:None
  16          ----------------------------*/
  17          void SendString(char *s)
  18          {
  19   1          while (*s)              //Check the end of the string
  20   1          {
  21   2              SendData(*s++);     //Send current char and increment string ptr
  22   2          }
  23   1      }
  24          
  25          void Uart1Init(void)            //115200bps@27.000MHz
  26          {
  27   1              SCON = 0x50;            //8位数据,可变波特率
  28   1              AUXR &= 0xBF;           //定时器1时钟为Fosc/12,即12T
  29   1              AUXR &= 0xFE;           //串口1选择定时器1为波特率发生器
  30   1              TMOD &= 0x0F;           //设定定时器1为16位自动重装方式
  31   1              TL1 = 0xFB;             //设定定时初值
  32   1              TH1 = 0xFF;             //设定定时初值
  33   1              ET1 = 0;                //禁止定时器1中断
  34   1              TR1 = 1;                //启动定时器1
  35   1              ES = 1; 
  36   1      }
  37          
  38          /*----------------------------
  39          UART interrupt service routine
  40          ----------------------------*/
  41          void Usart_Isr() interrupt 4
  42          {
  43   1              static unsigned short Str_Count = 0;
  44   1          if (RI)
  45   1          {
  46   2              RI = 0;             //Clear receive interrupt flag
  47   2      
  48   2                      RxBuffer[Str_Count] = SBUF; 
  49   2                      if(RxBuffer[Str_Count] == '\n')
  50   2                      {
  51   3                              for(++Str_Count; Str_Count < RxBuffer_Len; ++Str_Count)
  52   3                                      RxBuffer[Str_Count] = 0;
  53   3                              Str_Count = 0;
  54   3                              String_Analysis();
C51 COMPILER V9.60.7.0   USART                                                             12/05/2024 19:55:12 PAGE 2   

  55   3                      }
  56   2                      else
  57   2                              ++Str_Count;
  58   2                      
  59   2          }
  60   1          if (TI)
  61   1          {
  62   2              TI = 0;             //Clear transmit interrupt flag
  63   2              USART_Busy = 0;         //Clear transmit USART_Busy flag
  64   2          }
  65   1      }
  66          
  67          /*----------------------------
  68          Send a byte data to UART
  69          Input: dat (data to be sent)
  70          Output:None
  71          ----------------------------*/
  72          void SendData(char dat)
  73          {
  74   1          while (USART_Busy);         //Wait for the completion of the previous data is sent
  75   1          ACC = dat;              //Calculate the even parity bit P (PSW.0)
  76   1          if (P)                  //Set the parity bit according to P
  77   1          {
  78   2      #if (PARITYBIT == ODD_PARITY)
                      TB8 = 0;            //Set parity bit to 0
              #elif (PARITYBIT == EVEN_PARITY)
                      TB8 = 1;            //Set parity bit to 1
              #endif
  83   2          }
  84   1          else
  85   1          {
  86   2      #if (PARITYBIT == ODD_PARITY)
                      TB8 = 1;            //Set parity bit to 1
              #elif (PARITYBIT == EVEN_PARITY)
                      TB8 = 0;            //Set parity bit to 0
              #endif
  91   2          }
  92   1          USART_Busy = 1;
  93   1          SBUF = ACC;             //Send data to UART buffer
  94   1      }
  95          
  96          
  97          //适配vofa+串口示波器的JustFloat格式 浮点为大端 
  98          void SendFloat(unsigned char *Data) //发送一个字符
  99          {
 100   1              char i;
 101   1              for(i=0;i<4;++i)
 102   1                      SendData(Data[3-i]);
 103   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    276    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     22       3
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
